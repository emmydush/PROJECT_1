<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Camera Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Simple Camera Test</h1>
        
        <div class="row">
            <div class="col-md-8 mx-auto">
                <div class="card">
                    <div class="card-header">
                        <h5>Camera Access Test</h5>
                    </div>
                    <div class="card-body">
                        <p>This page will help you test if your camera is working properly.</p>
                        
                        <div class="mb-3">
                            <button id="startCamera" class="btn btn-primary">Start Camera</button>
                            <button id="stopCamera" class="btn btn-secondary" disabled>Stop Camera</button>
                        </div>
                        
                        <div class="mb-3">
                            <div id="cameraStatus" class="alert alert-info">Camera not started</div>
                        </div>
                        
                        <div class="mb-3">
                            <div id="cameraContainer" style="position: relative; width: 100%; height: 300px; border: 2px solid #007bff; border-radius: 8px; display: none; overflow: hidden;">
                                <video id="cameraVideo" style="width: 100%; height: 100%; object-fit: cover;" autoplay playsinline></video>
                                <div id="cameraOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none;">
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; height: 20%; border: 3px solid rgba(0, 255, 0, 0.8); box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5); animation: scannerPulse 2s infinite;"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h5>Instructions:</h5>
                            <ol>
                                <li>Click "Start Camera" to access your camera</li>
                                <li>Allow camera access when prompted by your browser</li>
                                <li>You should see your camera feed in the box above</li>
                                <li>If you see the feed, your camera is working properly</li>
                                <li>Click "Show Scanner Frame" to see the barcode scanning area</li>
                            </ol>
                        </div>
                        
                        <div class="mt-3">
                            <button id="toggleOverlay" class="btn btn-outline-primary" disabled>Show Scanner Frame</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
    @keyframes scannerPulse {
        0% {
            border-color: rgba(0, 255, 0, 0.8);
            box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
        }
        50% {
            border-color: rgba(0, 255, 0, 1);
            box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.4);
        }
        100% {
            border-color: rgba(0, 255, 0, 0.8);
            box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
        }
    }
    </style>

    <script>
        let stream = null;
        let overlayVisible = false;
        
        document.getElementById('startCamera').addEventListener('click', async function() {
            const cameraStatus = document.getElementById('cameraStatus');
            const cameraContainer = document.getElementById('cameraContainer');
            const cameraVideo = document.getElementById('cameraVideo');
            const cameraOverlay = document.getElementById('cameraOverlay');
            const startButton = document.getElementById('startCamera');
            const stopButton = document.getElementById('stopCamera');
            const toggleButton = document.getElementById('toggleOverlay');
            
            try {
                cameraStatus.textContent = 'Requesting camera access...';
                cameraStatus.className = 'alert alert-warning';
                
                // Request camera access
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { min: 640 },
                        height: { min: 480 }
                    } 
                });
                
                // Set up the video element
                cameraVideo.srcObject = stream;
                
                // Show the camera container
                cameraContainer.style.display = 'block';
                
                // Enable overlay toggle button
                toggleButton.disabled = false;
                
                // Update UI
                cameraStatus.textContent = 'Camera is working! You should see your camera feed above.';
                cameraStatus.className = 'alert alert-success';
                startButton.disabled = true;
                stopButton.disabled = false;
                
            } catch (error) {
                console.error('Error accessing camera:', error);
                cameraStatus.textContent = `Error accessing camera: ${error.message}`;
                cameraStatus.className = 'alert alert-danger';
                
                // Handle specific error types
                if (error.name === 'NotAllowedError') {
                    cameraStatus.textContent = 'Camera access denied. Please allow camera access in your browser settings and try again.';
                } else if (error.name === 'NotFoundError') {
                    cameraStatus.textContent = 'No camera found. Please connect a camera and try again.';
                } else if (error.name === 'NotReadableError') {
                    cameraStatus.textContent = 'Camera is already in use. Close other applications using the camera.';
                }
            }
        });
        
        document.getElementById('stopCamera').addEventListener('click', function() {
            const cameraStatus = document.getElementById('cameraStatus');
            const cameraContainer = document.getElementById('cameraContainer');
            const cameraVideo = document.getElementById('cameraVideo');
            const cameraOverlay = document.getElementById('cameraOverlay');
            const startButton = document.getElementById('startCamera');
            const stopButton = document.getElementById('stopCamera');
            const toggleButton = document.getElementById('toggleOverlay');
            
            // Stop all tracks
            if (stream) {
                const tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
            }
            
            // Clear the video element
            cameraVideo.srcObject = null;
            
            // Hide the camera container
            cameraContainer.style.display = 'none';
            
            // Hide overlay
            cameraOverlay.style.display = 'none';
            overlayVisible = false;
            toggleButton.textContent = 'Show Scanner Frame';
            
            // Update UI
            cameraStatus.textContent = 'Camera stopped.';
            cameraStatus.className = 'alert alert-info';
            startButton.disabled = false;
            stopButton.disabled = true;
            toggleButton.disabled = true;
        });
        
        document.getElementById('toggleOverlay').addEventListener('click', function() {
            const cameraOverlay = document.getElementById('cameraOverlay');
            const toggleButton = document.getElementById('toggleOverlay');
            
            if (overlayVisible) {
                // Hide overlay
                cameraOverlay.style.display = 'none';
                toggleButton.textContent = 'Show Scanner Frame';
                overlayVisible = false;
            } else {
                // Show overlay
                cameraOverlay.style.display = 'block';
                toggleButton.textContent = 'Hide Scanner Frame';
                overlayVisible = true;
            }
        });
    </script>
</body>
</html>
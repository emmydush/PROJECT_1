{% extends 'base.html' %}

{% block title %}Voice Assistant - {{ business_settings.business_name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2><i class="fas fa-microphone-alt"></i> Voice Assistant</h2>
        </div>
        <p class="text-muted">Talk to your inventory management system with voice commands.</p>
    </div>
</div>

<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h5>Voice Assistant Demo</h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <button id="voiceCommandButton" class="btn btn-primary btn-lg rounded-circle" style="width: 80px; height: 80px;">
                        <i class="fas fa-microphone fa-2x"></i>
                    </button>
                    <div id="voiceStatus" class="mt-2 text-muted">Ready</div>
                </div>
                
                <div class="mb-3">
                    <label for="searchInput" class="form-label">Command Input</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchInput" placeholder="Type or speak your command...">
                        <button class="btn btn-outline-secondary" type="button" id="voiceSearchButton">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Response</label>
                    <div class="border rounded p-3 bg-light" id="responseArea" style="min-height: 100px;">
                        <p class="text-muted mb-0">Voice assistant responses will appear here...</p>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="alert alert-info">
                            <h6><i class="fas fa-chart-line"></i> Report Commands</h6>
                            <ul class="mb-0">
                                <li>"Show me profit"</li>
                                <li>"What are the sales?"</li>
                                <li>"Display expenses"</li>
                                <li>"Show inventory report"</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-success">
                            <h6><i class="fas fa-box"></i> Product Commands</h6>
                            <ul class="mb-0">
                                <li>"Add new product"</li>
                                <li>"List all products"</li>
                                <li>"Show low stock items"</li>
                                <li>"Find expired products"</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="alert alert-warning">
                            <h6><i class="fas fa-users"></i> Customer Commands</h6>
                            <ul class="mb-0">
                                <li>"Add new customer"</li>
                                <li>"List all customers"</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-primary">
                            <h6><i class="fas fa-cash-register"></i> Sale Commands</h6>
                            <ul class="mb-0">
                                <li>"Create new sale"</li>
                                <li>"List all sales"</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-secondary">
                    <h6><i class="fas fa-info-circle"></i> General Commands</h6>
                    <ul class="mb-0">
                        <li>"Go to dashboard"</li>
                        <li>"What time is it?"</li>
                        <li>"What date is it?"</li>
                        <li>"Hello" or "Hi"</li>
                        <li>"Help me"</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Override the default voice command behavior for this page
document.addEventListener('DOMContentLoaded', function() {
    if (typeof window.voiceCommand !== 'undefined') {
        // Update the processCommand method for this specific page
        const originalProcessCommand = window.voiceCommand.processCommand;
        
        window.voiceCommand.processCommand = function(command) {
            command = command.toLowerCase().trim();
            
            // Update response area
            const responseArea = document.getElementById('responseArea');
            if (responseArea) {
                responseArea.innerHTML = `<p><strong>You said:</strong> ${command}</p>`;
            }
            
            // Handle different types of commands
            if (window.voiceCommand.handleSearchCommands(command)) {
                if (responseArea) {
                    const searchTerms = command
                        .replace('search for', '')
                        .replace('find', '')
                        .replace('look for', '')
                        .replace('show me', '')
                        .trim();
                    responseArea.innerHTML += `<p><strong>System:</strong> Searching for "${searchTerms}"</p>`;
                }
                return;
            }
            
            if (window.voiceCommand.handleNavigationCommands(command)) {
                const page = command
                    .replace('go to', '')
                    .replace('navigate to', '')
                    .replace('take me to', '')
                    .replace('open', '')
                    .trim();
                if (responseArea) {
                    responseArea.innerHTML += `<p><strong>System:</strong> Navigating to "${page}"</p>`;
                }
                return;
            }
            
            if (window.voiceCommand.handleInformationCommands(command)) {
                if (command.includes('what time') || command.includes('current time')) {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString();
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> The current time is ${timeString}</p>`;
                    }
                }
                
                if (command.includes('what date') || command.includes('current date')) {
                    const now = new Date();
                    const dateString = now.toLocaleDateString();
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Today is ${dateString}</p>`;
                    }
                }
                
                if (command.includes('who are you') || command.includes('what are you')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> I am your inventory management voice assistant.</p>`;
                    }
                }
                return;
            }
            
            // Report commands
            if (window.voiceCommand.handleReportCommands(command)) {
                if (command.includes('profit') || command.includes('loss') || command.includes('earnings')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Showing profit and loss report</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/reports/profit-loss/';
                    }, 1000);
                }
                
                if (command.includes('sales') || command.includes('revenue')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Showing sales report</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/reports/sales/';
                    }, 1000);
                }
                
                if (command.includes('expenses') || command.includes('costs')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Showing expenses report</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/reports/expenses/';
                    }, 1000);
                }
                
                if (command.includes('inventory') || command.includes('stock')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Showing inventory report</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/reports/inventory/';
                    }, 1000);
                }
                return;
            }
            
            // Product commands
            if (window.voiceCommand.handleProductCommands(command)) {
                if (command.includes('add product') || command.includes('create product')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Opening product creation form</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/products/create/';
                    }, 1000);
                }
                
                if (command.includes('list products') || command.includes('all products')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Showing all products</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/products/';
                    }, 1000);
                }
                return;
            }
            
            // Customer commands
            if (window.voiceCommand.handleCustomerCommands(command)) {
                if (command.includes('add customer') || command.includes('create customer')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Opening customer creation form</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/customers/create/';
                    }, 1000);
                }
                
                if (command.includes('list customers') || command.includes('all customers')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Showing all customers</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/customers/';
                    }, 1000);
                }
                return;
            }
            
            // Sale commands
            if (window.voiceCommand.handleSaleCommands(command)) {
                if (command.includes('new sale') || command.includes('create sale')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Opening point of sale system</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/sales/pos/';
                    }, 1000);
                }
                
                if (command.includes('list sales') || command.includes('all sales')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Showing all sales</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/sales/';
                    }, 1000);
                }
                return;
            }
            
            // Purchase commands
            if (window.voiceCommand.handlePurchaseCommands(command)) {
                if (command.includes('new purchase') || command.includes('create purchase')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Opening purchase order creation form</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/purchases/create/';
                    }, 1000);
                }
                
                if (command.includes('list purchases') || command.includes('all purchases')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Showing all purchases</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/purchases/';
                    }, 1000);
                }
                return;
            }
            
            // Inventory commands
            if (window.voiceCommand.handleInventoryCommands(command)) {
                if (command.includes('low stock') || command.includes('out of stock')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Showing low stock items</p>`;
                    }
                    setTimeout(() => {
                        window.location.href = '/products/?status=low_stock';
                    }, 1000);
                }
                
                if (command.includes('expired products') || command.includes('expired items')) {
                    if (responseArea) {
                        responseArea.innerHTML += `<p><strong>System:</strong> Showing expired products</p>`;
                    }
                    setTimeout(() => {
                        const today = new Date().toISOString().split('T')[0];
                        window.location.href = `/products/?expiry_date_before=${today}`;
                    }, 1000);
                }
                return;
            }
            
            // Greeting commands
            if (window.voiceCommand.handleGreetingCommands(command)) {
                if (responseArea) {
                    responseArea.innerHTML += `<p><strong>System:</strong> Hello! How can I help you today?</p>`;
                }
                return;
            }
            
            // Help commands
            if (window.voiceCommand.handleHelpCommands(command)) {
                if (responseArea) {
                    responseArea.innerHTML += `<p><strong>System:</strong> I can help you navigate the system, search for products, customers, and suppliers, create sales and purchases, view reports, and check inventory status.</p>`;
                }
                return;
            }
            
            // Default action
            if (responseArea) {
                responseArea.innerHTML += `<p><strong>System:</strong> I'm treating that as a search for "${command}"</p>`;
            }
            window.voiceCommand.searchInput.value = command;
            window.voiceCommand.submitSearch();
            window.voiceCommand.speak(`I'm searching for ${command}`);
        };
    }
});
</script>
{% endblock %}